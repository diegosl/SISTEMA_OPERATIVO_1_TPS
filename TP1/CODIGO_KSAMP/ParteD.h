/*///////////////////////////////////////////////////////////////////////////////////////////////////////////*/
/*///////////////////////////////////////IMPORTACION DE LIBRERIAS////////////////////////////////////////////*/
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#define BUFFSIZE 256
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////*/
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////*/

/*///////////////////////////////////////////////////////////////////////////////////////////////////////////*/
/*//////////////////////////////////////////////PROTOTIPOS///////////////////////////////////////////////////*/
void MostrarParteD(int a, int b);
void NumDePetADisco();
void CantDememoria();
void PromedioCarga();
void sleep(int a);
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////*/
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////*/

/*///////////////////////////////////////////////////////////////////////////////////////////////////////////*/
/*////////////////////////////////////////IMPLEMENTACION DE FUNCIONES////////////////////////////////////////*/

/*////////////////////////////////////////////////FUNCION 1//////////////////////////////////////////////////*/
void MostrarParteD(int a, int b)
{
	int j;

	printf("\n/////////////////////////PARTE D////////////////////////////\n");
	
	if((a>=b) || (a==0) || (b==0))
	{
		printf("LOS PARAMETROS DE DURACION DE INTERVALOS SON INCORRECTOS\n");
	}
	else
	{
		b = b/a;

		for(j=0; j<b; j++)
		{
			NumDePetADisco();
			CantDememoria();
			PromedioCarga();
			printf("[PAUSA DE %i SEGUNDOS]\n\n",a);
			sleep(a);
		}
	}
	printf("////////////////////////////////////////////////////////////\n");
}
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////*/

/*////////////////////////////////////////////////FUNCION 2//////////////////////////////////////////////////*/
void NumDePetADisco()
{
	FILE *f = NULL;
	char buffer[BUFFSIZE+1];
	char *match = NULL;
	size_t bytesLeidos;
	char dato[BUFFSIZE+1];
	int i;

	f = fopen("/proc/diskstats","r");

	if(f == NULL)
	{
		printf("NO SE HA PODIDIO ENCONTRAR EL ARCHIVO \n");
	}
	else
	{
		for(i=0; i<4; i++)
		{
			bytesLeidos = fread(buffer,1,sizeof(buffer),f);
		}

		if(bytesLeidos == 0)
		{
			printf("FALLO LECTURA \n");
		}
		else
		{
			buffer[bytesLeidos] = '\0'; 

			match = strstr(buffer, "sda");

			if(match==NULL)
			{
				printf("FALLO BUSQUEDA DE LINEA \n");
			}
			else
			{
				sscanf(match, "sda %s",dato);
				printf("NUMERO DE PETICIONES A DISCO REALIZADAS: %s\n",dato);
			}
		}
	}

	fclose(f);
}
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////*/

/*////////////////////////////////////////////////FUNCION 3//////////////////////////////////////////////////*/
void CantDememoria()
{
	FILE *f = NULL;
	char buffer[BUFFSIZE+1];
	char *match = NULL;
	size_t bytesLeidos;
	char dato1[BUFFSIZE+1];
	char dato2[BUFFSIZE+1];

	f = fopen("/proc/meminfo","r");

	if(f == NULL)
	{
		printf("NO SE HA PODIDIO ENCONTRAR EL ARCHIVO \n");
	}
	else
	{
		bytesLeidos = fread(buffer,1,sizeof(buffer),f);

		if(bytesLeidos == 0)
		{
			printf("FALLO LECTURA \n");
		}
		else
		{
			buffer[bytesLeidos] = '\0'; 

			match = strstr(buffer, "MemTotal:");

			if(match==NULL)
			{
				printf("FALLO BUSQUEDA DE LINEA \n");
			}
			else
			{
				sscanf(match, "MemTotal: %s",dato1);
			}

			match = strstr(buffer, "MemFree:");

			if(match==NULL)
			{
				printf("FALLO BUSQUEDA DE LINEA \n");
			}
			else
			{
				sscanf(match, "MemFree: %s",dato2);
			}

			printf("MEMORIA TOTAL: %s kB\nMEMORIA LIBRE: %s kB\n",dato1,dato2);
		}
	}

	fclose(f);
}
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////*/

/*////////////////////////////////////////////////FUNCION 4//////////////////////////////////////////////////*/
void PromedioCarga()
{
	FILE *f = NULL;
	char buffer[BUFFSIZE+1];

	f = fopen("/proc/loadavg","r");

	if(f == NULL)
	{
		printf("NO SE HA PODIDIO ENCONTRAR EL ARCHIVO \n");
	}
	else
	{
		fscanf(f,"%s",buffer);

		printf("PROMEDIO DE CARGA EN EL ULTIMO MINUTO: %s\n",buffer);
	}

	fclose(f);
}
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////*/
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////*/